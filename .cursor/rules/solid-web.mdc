---
description: Web platform runtime — rendering, SSR, Portal, Dynamic
globs: packages/solid-web/**
alwaysApply: false
---

# Solid Web (`@solidjs/web`)

## Package Role

Web-specific runtime providing DOM rendering, hydration, SSR methods, and web-only components. Delegates DOM operations to `dom-expressions`. Has conditional exports: browser gets `dist/web.js`, server environments get `dist/server.js`.

## Client Entry (`src/index.ts`)

Re-exports from `client.ts` → `dom-expressions/src/client.js`:
- `render`, `hydrate`, `insert`, `spread`, `getNextElement`, `SVGElements`, `clearDelegatedEvents`

Additional exports:
- `Portal`, `Dynamic`, `createDynamic`
- Flow controls re-exported from `solid-js`
- `isServer: false`, `isDev: boolean`

## Server Entry (`server/index.ts`)

Re-exports from `server.ts` → `dom-expressions/src/server.js`:
- `renderToString`, `renderToStringAsync`, `renderToStream`
- SSR helpers: `ssr`, `ssrElement`, `ssrClassList`, `ssrStyle`, `ssrAttribute`, `escape`

Additional:
- Simplified `Dynamic` (no memoization — server is stateless)
- `Portal` throws error (not supported server-side)
- `isServer: true`, `isDev: false`
- `provideRequestEvent` uses `AsyncLocalStorage` for request context

## Portal Component

Renders children to a different DOM location (defaults to `document.body`).

- Uses text markers (`treeMarker`, `startMarker`, `endMarker`) for tracking
- Creates element proxy to track `_$host` property
- SVG-aware
- Cleanup removes all nodes between markers

## Dynamic Component

Renders components or elements dynamically based on `component` prop.

- `createMemo` caches the component reference
- Handles: function components, string tags (HTML/SVG via `SVGElements` set), undefined
- Hydration-aware via `sharedConfig.hydrating` and `getNextElement()`
- Uses `spread()` to apply props to native elements

## Storage Submodule

Exported as `@solidjs/web/storage`. Uses `seroval` and `seroval-plugins` for serialization.

## Server-Mock (`src/server-mock.ts`)

Browser-safe stubs that log errors if server APIs are accidentally used in browser: `renderToString`, `renderToStringAsync`, `renderToStream`, SSR helpers.

## Build Outputs

- `dist/web.js` — production browser
- `dist/dev.js` — development browser (with `_SOLID_DEV_` / `_DX_DEV_` enabled)
- `dist/server.js` — server (Node/Deno/Worker)

Rollup with Babel for JSX transformation, `@rollup/plugin-replace` for dev/prod flags.
